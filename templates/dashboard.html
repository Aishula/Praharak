<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SIEM Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  {% load static %}  
  <link href="{% static 'main.css' %}" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .card {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="siem-title">Security Information And Event Management Dashboard</h1>
    <div class="row">

      <!-- Table Section -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">Log Sources</div>
          <div class="card-body">
            <table class="table table-striped" id="logTable">
              <thead>
                <tr>
                  <th>Source</th>
                  <th>IP</th>
                  <th>Protocol</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Firewall</td>
                  <td>192.168.1.1</td>
                  <td>TCP</td>
                  <td>Normal</td>
                </tr>
                <tr>
                  <td>Router</td>
                  <td>192.168.1.2</td>
                  <td>UDP</td>
                  <td>Suspicious</td>
                </tr>
                <tr>
                  <td>Switch</td>
                  <td>192.168.1.3</td>
                  <td>TCP</td>
                  <td>Normal</td>
                </tr>
                <tr>
                  <td>Server</td>
                  <td>192.168.1.4</td>
                  <td>UDP</td>
                  <td>Critical</td>
                </tr>
                <tr>
                  <td>Workstation</td>
                  <td>192.168.1.5</td>
                  <td>TCP</td>
                  <td>Normal</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <script>
        document.addEventListener("DOMContentLoaded", function() {
          var table = document.getElementById("logTable");
          var rows = table.getElementsByTagName("tr");
      
          for (var i = 1; i < rows.length; i++) {
            var cells = rows[i].getElementsByTagName("td");
            var remarks = cells[3].innerText.trim();
      
            if (remarks != "Normal") {
              rows[i].classList.add("table-danger");
            }
          }
        });
      </script>
      
      <!-- Bar Chart Section -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">Attack vs Normal Data</div>
          <div class="card-body">
            <canvas id="attackNormalChart"></canvas>
          </div>
        </div>
      </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        // Static data for the charts
        var time_stamps = ['2023-01-01', '2023-01-02', '2023-01-03', '2023-01-04', '2023-01-05'];
        var attack_data = [5, 10, 15, 10, 5];
        var normal_data = [15, 10, 5, 10, 15];
  
        var ctx = document.getElementById('attackNormalChart').getContext('2d');
        var attackNormalChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: time_stamps,
            datasets: [
              {
                label: 'Attack Data',
                data: attack_data,
                backgroundColor: '#D22B2B',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
              },
              {
                label: 'Normal Data',
                data: normal_data,
                backgroundColor: 'rgb(0, 0, 128)',
                borderColor: '#191970',
                borderWidth: 1
              }
            ]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
    });
  </script>

    {% comment %} <!-- Simulation Wave Section --> YO CHAI SIMULATION KO {% endcomment %}
    <div class="row">
      <div class="col-md-12">
          <div class="card">
              <div class="card-header">Network Traffic</div>
              <div class="card-body">
                  <canvas id="networkTrafficChart"></canvas>
              </div>
          </div>
      </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
      // Sample data for the static simulation wave
      const labels = Array.from({length: 50}, (_, i) => i);
      const data = labels.map(x => Math.sin(x / 5) * 10 + 20);

      const ctx = document.getElementById('networkTrafficChart').getContext('2d');
      const networkTrafficChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: labels,
              datasets: [{
                  label: 'Packet Flow Rate',
                  data: data,
                  borderColor: 'rgb(25, 25, 112)',
                  backgroundColor: '#ADD8E6',
                  fill: true,
                  tension: 0.6
              }]
          },
          options: {
              responsive: true,
              scales: {
                  x: {
                      title: {
                          display: true,
                          text: 'Time'
                      }
                  },
                  y: {
                      title: {
                          display: true,
                          text: 'Packet Flow Rate'
                      },
                      min: 0,
                      max: 40
                  }
              },
              plugins: {
                  legend: {
                      display: true,
                      position: 'top'
                  }
              }
          }
      });
  </script>

       <script>
        const flowSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/flow_data/'
        );

        flowSocket.onopen = function(e) {
            console.log('Connection established');
        };

        flowSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            let message = data["message"];
            console.log(message);
        };

        flowSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

        function sendMessage() {
            flowSocket.send(JSON.stringify({
                'message': "Hi, I'm From browser"
            }));
        }
    </script>
    </div>
  </div>
</body>
</html>

